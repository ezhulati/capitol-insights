import{C as t}from"./mdx-sanity-0ddb556c.js";import"./index-7ca087c8.js";import"./motion-55a23653.js";import"./react-c3d7d9ee.js";import"./vendor-f90ff671.js";import"./ui-d40fa30f.js";const e=/_key\s*==\s*['"](.*)['"]/;function n(t){if(!Array.isArray(t))throw new Error("Path is not an array");return t.reduce(((t,n,r)=>{const o=typeof n;if("number"===o)return`${t}[${n}]`;if("string"===o)return`${t}${0===r?"":"."}${n}`;if(function(t){return"string"==typeof t?e.test(t.trim()):"object"==typeof t&&"_key"in t}(n)&&n._key)return`${t}[_key=="${n._key}"]`;if(Array.isArray(n)){const[e,r]=n;return`${t}[${e}:${r}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(n)}\``)}),"")}const r={"\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","'":"\\'","\\":"\\\\"},o={"\\f":"\f","\\n":"\n","\\r":"\r","\\t":"\t","\\'":"'","\\\\":"\\"};function i(t){const e=[],n=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let r;for(;null!==(r=n.exec(t));)if(void 0===r[1])if(void 0===r[2])if(void 0===r[3]);else{const t=r[3].replace(/\\(\\')/g,(t=>o[t]));e.push({_key:t,_index:-1})}else e.push(parseInt(r[2],10));else{const t=r[1].replace(/\\(\\|f|n|r|t|')/g,(t=>o[t]));e.push(t)}return e}function s(t){return t.map((t=>{if("string"==typeof t||"number"==typeof t)return t;if(""!==t._key)return{_key:t._key};if(-1!==t._index)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)}))}function l(t,e){if(!(null==e?void 0:e.mappings))return;const n=function(t){return`$${t.map((t=>"string"==typeof t?`['${t.replace(/[\f\n\r\t'\\]/g,(t=>r[t]))}']`:"number"==typeof t?`[${t}]`:""!==t._key?`[?(@._key=='${t._key.replace(/['\\]/g,(t=>r[t]))}')]`:`[${t._index}]`)).join("")}`}(t.map((t=>{if("string"==typeof t||"number"==typeof t)return t;if(-1!==t._index)return t._index;throw new Error(`invalid segment:${JSON.stringify(t)}`)})));if(void 0!==e.mappings[n])return{mapping:e.mappings[n],matchedPath:n,pathSuffix:""};const o=Object.entries(e.mappings).filter((([t])=>n.startsWith(t))).sort((([t],[e])=>e.length-t.length));if(0==o.length)return;const[i,s]=o[0];return{mapping:s,matchedPath:i,pathSuffix:n.substring(i.length)}}function u(t){return"object"==typeof t&&null!==t}function a(t,e,n=[]){if(function(t){return null!==t&&Array.isArray(t)}(t))return t.map(((t,r)=>{if(u(t)){const o=t._key;if("string"==typeof o)return a(t,e,n.concat({_key:o,_index:r}))}return a(t,e,n.concat(r))}));if(u(t)){if("block"===t._type||"span"===t._type){const r={...t};return"block"===t._type?r.children=a(t.children,e,n.concat("children")):"span"===t._type&&(r.text=a(t.text,e,n.concat("text"))),r}return Object.fromEntries(Object.entries(t).map((([t,r])=>[t,a(r,e,n.concat(t))])))}return e(t,n)}function c(t,e,n){return a(t,((t,r)=>{if("string"!=typeof t)return t;const o=l(r,e);if(!o)return t;const{mapping:s,matchedPath:u}=o;if("value"!==s.type||"documentValue"!==s.source.type)return t;const a=e.documents[s.source.document],c=e.paths[s.source.path],p=i(u),f=i(c).concat(r.slice(p.length));return n({sourcePath:f,sourceDocument:a,resultPath:r,value:t})}))}const p=".",f=`drafts${p}`,d=`versions${p}`;function h(t){return t.startsWith(f)}function g(t){return t.startsWith(d)}function y(t){const{baseUrl:e,workspace:r="default",tool:o="default",id:i,type:l,path:u,projectId:a,dataset:c}=t;if(!e)throw new Error("baseUrl is required");if(!u)throw new Error("path is required");if(!i)throw new Error("id is required");if("/"!==e&&e.endsWith("/"))throw new Error("baseUrl must not end with a slash");const d="default"===r?void 0:r,y="default"===o?void 0:o,m=function(t){return g(t)?t.split(p).slice(2).join(p):h(t)?t.slice(f.length):t}(i),$=Array.isArray(u)?n(s(u)):u,v=new URLSearchParams({baseUrl:e,id:m,type:l,path:$});if(d&&v.set("workspace",d),y&&v.set("tool",y),a&&v.set("projectId",a),c&&v.set("dataset",c),function(t){return!h(t)&&!g(t)}(i))v.set("perspective","published");else if(g(i)){const t=function(t){if(!g(t))return;const[e,n,...r]=t.split(p);return n}(i);v.set("perspective",t)}const _=["/"===e?"":e];d&&_.push(d);const b=["mode=presentation",`id=${m}`,`type=${l}`,`path=${encodeURIComponent($)}`];return y&&b.push(`tool=${y}`),_.push("intent","edit",`${b.join(";")}?${v}`),_.join("/")}const m=({sourcePath:t,resultPath:e,value:n})=>{if(/^\d{4}-\d{2}-\d{2}/.test(r=n)&&Date.parse(r)||function(t){try{new URL(t,t.startsWith("/")?"https://acme.com":void 0)}catch{return!1}return!0}(n))return!1;var r;const o=t.at(-1);return!("slug"===t.at(-2)&&"current"===o||"string"==typeof o&&(o.startsWith("_")||o.endsWith("Id"))||t.some((t=>"meta"===t||"metadata"===t||"openGraph"===t||"seo"===t))||v(t)||v(e)||"string"==typeof o&&$.has(o))},$=new Set(["color","colour","currency","email","format","gid","hex","href","hsl","hsla","icon","id","index","key","language","layout","link","linkAction","locale","lqip","page","path","ref","rgb","rgba","route","secret","slug","status","tag","template","theme","type","textTheme","unit","url","username","variant","website"]);function v(t){return t.some((t=>"string"==typeof t&&null!==t.match(/type/i)))}function _(n,r,o){var i,s,l,u,a,p,f,d,h;const{filter:g,logger:$,enabled:v}=o;if(!v){const t="config.enabled must be true, don't call this function otherwise";throw null==(i=null==$?void 0:$.error)||i.call($,`[@sanity/client]: ${t}`,{result:n,resultSourceMap:r,config:o}),new TypeError(t)}if(!r)return null==(s=null==$?void 0:$.error)||s.call($,"[@sanity/client]: Missing Content Source Map from response body",{result:n,resultSourceMap:r,config:o}),n;if(!o.studioUrl){const t="config.studioUrl must be defined";throw null==(l=null==$?void 0:$.error)||l.call($,`[@sanity/client]: ${t}`,{result:n,resultSourceMap:r,config:o}),new TypeError(t)}const _={encoded:[],skipped:[]},k=c(n,r,(({sourcePath:e,sourceDocument:n,resultPath:r,value:i})=>{if(!1===("function"==typeof g?g({sourcePath:e,resultPath:r,filterDefault:m,sourceDocument:n,value:i}):m({sourcePath:e,resultPath:r,value:i})))return $&&_.skipped.push({path:b(e),value:`${i.slice(0,20)}${i.length>20?"...":""}`,length:i.length}),i;$&&_.encoded.push({path:b(e),value:`${i.slice(0,20)}${i.length>20?"...":""}`,length:i.length});const{baseUrl:s,workspace:l,tool:u}=function(t){let e="string"==typeof t?t:t.baseUrl;return"/"!==e&&(e=e.replace(/\/$/,"")),"string"==typeof t?{baseUrl:e}:{...t,baseUrl:e}}("function"==typeof o.studioUrl?o.studioUrl(n):o.studioUrl);if(!s)return i;const{_id:a,_type:c,_projectId:p,_dataset:f}=n;return t(i,{origin:"sanity.io",href:y({baseUrl:s,workspace:l,tool:u,id:a,type:c,path:e,...!o.omitCrossDatasetReferenceData&&{dataset:f,projectId:p}})},!1)}));if($){const t=_.skipped.length,n=_.encoded.length;if((t||n)&&(null==(u=(null==$?void 0:$.groupCollapsed)||$.log)||u("[@sanity/client]: Encoding source map into result"),null==(a=$.log)||a.call($,`[@sanity/client]: Paths encoded: ${_.encoded.length}, skipped: ${_.skipped.length}`)),_.encoded.length>0&&(null==(p=null==$?void 0:$.log)||p.call($,"[@sanity/client]: Table of encoded paths"),null==(f=(null==$?void 0:$.table)||$.log)||f(_.encoded)),_.skipped.length>0){const t=new Set;for(const{path:n}of _.skipped)t.add(n.replace(e,"0").replace(/\[\d+\]/g,"[]"));null==(d=null==$?void 0:$.log)||d.call($,"[@sanity/client]: List of skipped paths",[...t.values()])}(t||n)&&(null==(h=null==$?void 0:$.groupEnd)||h.call($))}return k}function b(t){return n(s(t))}var k=Object.freeze({__proto__:null,stegaEncodeSourceMap:_});export{c as encodeIntoResult,_ as stegaEncodeSourceMap,k as stegaEncodeSourceMap$1};
