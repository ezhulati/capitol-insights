<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <meta name="theme-color" content="#102A43" />
    
    <!-- Preload key fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Georgia:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <!-- Primary SEO -->
    <title>Capitol Insights | Texas Government Relations & Lobbying</title>
    <meta name="description" content="Capitol Insights delivers ethical, effective government relations services throughout Texas, transforming policy challenges into strategic advantages for organizations.">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://capitol-insights.com/" />
    <meta property="og:title" content="Capitol Insights | Texas Government Relations" />
    <meta property="og:description" content="Transforming policy challenges into strategic business advantages through ethical and effective government relations services." />
    <meta property="og:image" content="https://images.unsplash.com/photo-1585468274952-66591eb14165?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=630" />
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Capitol Insights | Texas Government Relations" />
    <meta name="twitter:description" content="Transforming policy challenges into strategic business advantages through ethical and effective government relations services." />
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1585468274952-66591eb14165?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=630" />
    
    <!-- Structured Data for Rich Results -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "Capitol Insights",
        "description": "Capitol Insights delivers ethical, effective government relations services throughout Texas, transforming policy challenges into strategic advantages for organizations.",
        "image": "https://images.unsplash.com/photo-1585468274952-66591eb14165?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&h=630",
        "url": "https://capitol-insights.com",
        "telephone": "214-213-3443",
        "address": {
          "@type": "PostalAddress",
          "addressLocality": "Dallas & Austin",
          "addressRegion": "TX",
          "addressCountry": "US"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": "32.7767",
          "longitude": "-96.7970"
        },
        "openingHoursSpecification": {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": [
            "Monday",
            "Tuesday",
            "Wednesday",
            "Thursday",
            "Friday"
          ],
          "opens": "09:00",
          "closes": "17:00"
        },
        "sameAs": [
          "https://twitter.com/capitolinsights",
          "https://linkedin.com/company/capitol-insights"
        ]
      }
    </script>
    
    <!-- PWA Support -->
    <link rel="apple-touch-icon" href="/vite.svg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Performance optimizations -->
    <link rel="dns-prefetch" href="https://images.unsplash.com">
    <link rel="preconnect" href="https://images.unsplash.com">
    
    <!-- Accessibility -->
    <meta name="apple-mobile-web-app-title" content="Capitol Insights">
    <meta name="application-name" content="Capitol Insights">
    
    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js" defer></script>
  </head>
  <body class="antialiased text-slate-700 bg-white">
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
    <script>
      // Wait for document to be fully loaded
      document.addEventListener('DOMContentLoaded', function() {
        console.log('DOMContentLoaded - Checking for Netlify Identity');
        
        // Function to initialize Netlify Identity handling
        function initNetlifyIdentity() {
          console.log('Initializing Netlify Identity handler');
          
          if (window.netlifyIdentity) {
            window.netlifyIdentity.on("init", user => {
              console.log('Netlify Identity initialized', user ? 'with user' : 'without user');
              
              if (!user) {
                window.netlifyIdentity.on("login", () => {
                  console.log('User logged in, redirecting to admin');
                  document.location.href = "/admin/";
                });
              }
            });
            
            // Handle the invite token redirect
            const hash = window.location.hash;
            if (hash && hash.startsWith('#invite_token=')) {
              const token = hash.replace('#invite_token=', '');
              console.log('Found invite token, handling signup');
              
              // Add small delay to ensure widget is fully loaded
              setTimeout(() => {
                try {
                  console.log('Opening signup modal');
                  window.netlifyIdentity.open('signup');
                  
                  console.log('Accepting invite with token');
                  window.netlifyIdentity.gotrue.acceptInvite(token, null, false)
                    .then(() => {
                      console.log('Invite accepted, redirecting to admin');
                      // After sign up, redirect to admin
                      setTimeout(function() {
                        document.location.href = "/admin/";
                      }, 1500);
                    })
                    .catch(err => {
                      console.error('Error accepting invite:', err);
                      alert('There was an error accepting your invitation. Please contact the site administrator.');
                    });
                } catch (error) {
                  console.error('Error in invite handling:', error);
                }
              }, 500);
            }
          } else {
            console.log('Netlify Identity not found, retrying...');
            // If netlifyIdentity isn't loaded yet, wait and try again
            setTimeout(initNetlifyIdentity, 500);
          }
        }
        
        // Start the process
        initNetlifyIdentity();
      });
    </script>
    <noscript>
      <div style="padding: 2rem; text-align: center;">
        <h1>JavaScript Required</h1>
        <p>Please enable JavaScript to use this application. Capitol Insights provides government relations services throughout Texas.</p>
      </div>
    </noscript>
  </body>
</html>
